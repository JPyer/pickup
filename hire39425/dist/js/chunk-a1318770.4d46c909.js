(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a1318770"],{"158f":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=this,n=t.$createElement,a=t._self._c||n;return a("page-header-wrapper",[a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"音频名称"}},[a("a-input",{attrs:{placeholder:""},model:{value:t.queryParam.name,callback:function(e){t.$set(t.queryParam,"name",e)},expression:"queryParam.name"}})],1)],1),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"设备"}},[a("a-select",{attrs:{placeholder:"全部","default-value":""},on:{change:t.deviceChange},model:{value:t.queryParam.device_id,callback:function(e){t.$set(t.queryParam,"device_id",e)},expression:"queryParam.device_id"}},[a("a-select-option",{attrs:{value:""}},[t._v("全部")]),t._l(t.deviceOptions,(function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(" "+t._s(e.device_name)+" ")])}))],2)],1)],1),[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"上传日期"}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入上传日期"},model:{value:t.queryParam.date,callback:function(e){t.$set(t.queryParam,"date",e)},expression:"queryParam.date"}})],1)],1)],a("a-col",{attrs:{md:t.advanced?24:8,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons",style:t.advanced&&{float:"right",overflow:"hidden"}||{}},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$refs.table.refresh(!0)}}},[t._v("查询")]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return e.queryParam={}}}},[t._v("重置")])],1)])],2)],1)],1),a("div",{staticClass:"table-operator"}),a("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:t.columns,data:t.loadData,alert:!0,rowSelection:t.rowSelection,showPagination:"auto"},scopedSlots:t._u([{key:"serial",fn:function(e,n,i){return a("span",{},[t._v(" "+t._s(i+1)+" ")])}},{key:"description",fn:function(e){return a("span",{},[a("ellipsis",{attrs:{length:4,tooltip:""}},[t._v(t._s(e))])],1)}},{key:"action",fn:function(e,n){return a("span",{},[[a("a-button",{ref:"record_btn",attrs:{disabled:0===n.status,size:"small",type:"primary"},on:{click:function(e){return t.playAudio(n)}}},[a("a-icon",{attrs:{type:"play-circle"}}),t._v(" 回播 ")],1),a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(e){return t.handleEdit(n)}}},[t._v("修改")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-popconfirm",{attrs:{title:"是否要删除该音频记录（音频文件请自行移除）？"},on:{confirm:function(e){return t.delete_audio(n.id)}}},[a("a",{staticStyle:{color:"red"}},[t._v("删除")])])]],2)}}])}),a("create-form",{ref:"createModal",attrs:{visible:t.visible,loading:t.confirmLoading,model:t.mdl},on:{cancel:t.handleCancel,ok:t.handleOk}}),a("audio-play-form",{ref:"playAudioModal",attrs:{visible:t.play_visible,loading:t.play_confirmLoading,audioSrc:t.audioSrc,audioTitle:t.audioTitle,model:t.mdl,audioAuthor:t.audioAuthor},on:{cancel:t.handlePlayCancel}})],1)],1)},i=[],r=(n("d3b7"),n("5530")),o=n("c1df"),u=n.n(o),c=n("2af9"),l=n("dfe3"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{title:"编辑音频信息",width:640,visible:e.visible,options:e.options,confirmLoading:e.loading},on:{ok:function(){e.$emit("ok")},cancel:function(){e.$emit("cancel")}}},[n("a-spin",{attrs:{spinning:e.loading}},[n("a-form",e._b({attrs:{form:e.form}},"a-form",e.formLayout,!1),[n("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.model&&e.model.id>0,expression:"model && model.id > 0"}],attrs:{label:"ID"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id",{initialValue:0}],expression:"['id', { initialValue: 0 }]"}],attrs:{disabled:""}})],1),n("a-form-item",{attrs:{label:"音频名称"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!1,message:"默认为空,可以指定以便检索"}]}],expression:"['name', {rules:[{required: false, message: '默认为空,可以指定以便检索'}]}]"}]})],1),n("a-form-item",{attrs:{label:"文件路径"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["file_path",{rules:[{required:!1,message:"请输入file_path"}]}],expression:"['file_path', {rules:[{required: false, message: '请输入file_path'}]}]"}],attrs:{disabled:""}})],1),n("a-form-item",{attrs:{label:"文件大小"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["file_size"],expression:"['file_size']"}],attrs:{disabled:""}})],1),n("a-form-item",{attrs:{label:"时长"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["duration"],expression:"['duration']"}],attrs:{disabled:""}})],1)],1)],1)],1)},s=[],f=(n("4160"),n("88bc")),m=n.n(f),p=["id","name","file_path","file_size","duration"],h={name:"AudioEditForm",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){return null}},options:{type:Array,default:function(){return null}}},data:function(){return this.formLayout={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:13}}},{form:this.$form.createForm(this)}},created:function(){var e=this;p.forEach((function(t){return e.form.getFieldDecorator(t)})),this.$watch("model",(function(){e.model&&e.form.setFieldsValue(m()(e.model,p))}))}},b=h,v=n("2877"),y=Object(v["a"])(b,d,s,!1,null,null,null),g=y.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{title:"播放音频",width:850,visible:e.visible,options:e.options,confirmLoading:e.loading},on:{cancel:function(){e.$emit("cancel")}}},[n("audio",{ref:"audioModel",attrs:{id:"audio",controls:"",paused:!e.visible,nodownload:"nodownload",crossorigin:"anonymous",preload:"auto",autoplay:"autoplay"},on:{timeupdate:e.onLoadedmetadata}},[n("source",{attrs:{type:"audio/wav"}})]),n("div",[n("canvas",{attrs:{id:"canvas1",width:"800",height:"150"}}),n("canvas",{attrs:{id:"canvas2",width:"800",height:"150"}})])])},_=[];n("ace4"),n("3ca3"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("ddb0"),n("2b3d"),n("96cf"),n("e6cf");var A=n("0f7d"),j=n.n(A),O=n("e819"),S=n("9fb0"),x=n("8ded"),q=n.n(x);n("13d5"),n("c19f"),n("fd87"),n("8b09"),n("143c");function C(e,t,n,a){var i=e.byteLength,r=new ArrayBuffer(44+i),o=new DataView(r);function u(e,t,n){for(var a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}var c=0;function l(e,t,n){n=new Int32Array(n);for(var a=0;a<n.length;a++,t+=4)e.setInt32(t,n[a],!0)}function d(e,t,n){n=new Int16Array(n);for(var a=0;a<n.length;a++,t+=2)e.setInt16(t,n[a],!0)}function s(e,t,n){n=new Int8Array(n);for(var a=0;a<n.length;a++,t++)e.setInt8(t,n[a],!0)}return u(o,c,"RIFF"),c+=4,o.setUint32(c,36+i,!0),c+=4,u(o,c,"WAVE"),c+=4,u(o,c,"fmt "),c+=4,o.setUint32(c,16,!0),c+=4,o.setUint16(c,1,!0),c+=2,o.setUint16(c,a,!0),c+=2,o.setUint32(c,t,!0),c+=4,o.setUint32(c,t*a*(n/8),!0),c+=4,o.setUint16(c,a*(n/8),!0),c+=2,o.setUint16(c,n,!0),c+=2,u(o,c,"data"),c+=4,o.setUint32(c,i,!0),c+=4,16===n?d(o,44,e):8===n?s(o,44,e):l(o,44,e),o}var k={name:"AudioPlayForm",components:{aplayer:j.a,config:O["a"]},props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){return null}},options:{type:Array,default:function(){return null}},audioSrc:{type:String,default:function(){return null}},audioTitle:{type:String,default:function(){return null}},audioAuthor:{type:String,default:function(){return null}}},data:function(){return this.formLayout={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:13}}},{form:this.$form.createForm(this),music:{title:this.audioTitle,artist:this.audioAuthor,src:this.audioSrc,autoplay:!0},autoplay:!0}},created:function(){},methods:{play:function(){this.draw("audio_file")},getAudio:function(){var e=this;new Promise((function(t,n){var a={id:e.model.id,tag:"audio"};l["b"].playAudio(a).then((function(t){if(200===t.code){var n=URL.createObjectURL(t),a=document.querySelector("#audio");a.src=n,e.draw(),a.onended=function(){}}}))})).then()},draw:function(e){var t=this,n=new AudioContext,a=null,i=new XMLHttpRequest;i.open("GET",this.audioSrc,!0),i.setRequestHeader("Authentication","Token "+q.a.get(S["a"])),i.responseType="arraybuffer";i.onload=function(){var r=i.response;if(200===i.status){var o=document.querySelector("#audio"),u=C(r,16e3,24,1);o.src=window.URL.createObjectURL(new Blob([u],{type:"audio/wav"})),n.decodeAudioData(u.buffer,(function(t){var i=n.createAnalyser(),r=document.querySelector("audio");r.crossorigin="anonymous",r.nodownload="nodownload",a="buffer"===e?n.createBufferSource():n.createMediaElementSource(r),a.connect(i),i.connect(n.destination),a.buffer=t,"buffer"===e?a.start(0):r.play();var o=document.getElementById("canvas1"),u=o.width,c=o.height-2,l=1,d=800,s=o.getContext("2d"),f=2,m="#001529",p=[],h=s.createLinearGradient(0,0,0,300);function b(){var e=new Uint8Array(i.frequencyBinCount);i.getByteFrequencyData(e),s.clearRect(0,0,u,c);for(var t=0;t<d;t++){var n=e[t];p.length<Math.round(d)&&p.push(n),s.fillStyle=m,n<p[t]?s.fillRect(2*t,c- --p[t],l,f):(s.fillRect(2*t,c-n,l,f),p[t]=n),s.fillStyle=h,s.fillRect(2*t,c-n+f,l,c)}requestAnimationFrame(b)}h.addColorStop(1,"#0f0"),h.addColorStop(.5,"#ff0"),h.addColorStop(0,"#4aeb46"),requestAnimationFrame(b);var v=document.getElementById("canvas2"),y=v.width,g=v.height-2,w=v.getContext("2d"),_=w,A=i.fftSize,j=new Uint8Array(A);_.clearRect(0,0,y,g);var O=function e(){requestAnimationFrame(e);i.getByteTimeDomainData(j),_.fillStyle="#001529",_.fillRect(0,0,y,g),_.lineWidth=2,_.strokeStyle="#4aeb46",_.beginPath();for(var t=1*y/A,n=0,a=0;a<A;a++){var r=j[a]/128,u=r*g/2;0===a?_.moveTo(n,u):_.lineTo(n,u),n+=t}_.lineTo(o.width,o.height/2),_.stroke()};O()}),(function(e){}))}else t.$message.error("访问资源失败：权限不足或资源暂不支持")},i.onerror=function(){t.$message.error("访问资源失败：权限不足或资源不存在")},i.send()},onTimeupdate:function(e){this.$refs.audioModal.currentTime=e.target.currentTime},seeking:function(){},onLoadedmetadata:function(e){}},watch:{visible:function(e,t){var n=document.querySelector("audio");if(e){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame;try{new AudioContext}catch(a){return this.$message.error("您的浏览器不支持AudioContext,无法显示频谱图"),!1}this.music.src=this.audioSrc,this.music.artist=this.audioAuthor,this.music.title=this.audioTitle,this.draw("audio_file")}else n.pause(),this.audioSrc=null}}},L=k,$=(n("dc02"),Object(v["a"])(L,w,_,!1,null,null,null)),F=$.exports,P=n("aa98"),R=n("ca00"),I=[{title:"#",scopedSlots:{customRender:"serial"}},{title:"ID",dataIndex:"id"},{title:"音频名称",dataIndex:"name"},{title:"文件路径",dataIndex:"file_path"},{title:"时长",dataIndex:"duration"},{title:"大小(M)",dataIndex:"file_size"},{title:"所属设备",dataIndex:"device_name"},{title:"创建时间",dataIndex:"gmt_create"},{title:"操作",dataIndex:"action",width:"200px",scopedSlots:{customRender:"action"}}],T={name:"AudioList",components:{STable:c["k"],Ellipsis:c["c"],CreateForm:g,AudioPlayForm:F},data:function(){var e=this;return this.columns=I,{visible:!1,confirmLoading:!1,play_visible:!1,play_confirmLoading:!1,audioSrc:null,audioTitle:null,audioAuthor:null,mdl:null,advanced:!1,queryParam:{},deviceOptions:[],loadData:function(t){var n=Object.assign({},t,e.queryParam);return l["b"].getAudioList(n).then((function(e){return e}))},selectedRowKeys:[],selectedRows:[]}},filters:{},created:function(){var e=this;Object(P["m"])().then((function(t){e.deviceOptions=t.data}));Object(R["a"])("device_id")},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{handleAdd:function(){this.mdl=null,this.visible=!0},handleEdit:function(e){this.visible=!0,this.mdl=Object(r["a"])({},e)},handleOk:function(){var e=this,t=this.$refs.createModal.form;this.confirmLoading=!0,t.validateFields((function(n,a){n?e.confirmLoading=!1:new Promise((function(n,i){a.id>0&&l["b"].editAudio(a).then((function(n){200===n.code?(e.$message.info(n.message),t.resetFields(),e.visible=!1,e.confirmLoading=!1,e.$refs.table.refresh()):e.$message.error("系统错误：".concat(n.message))})).catch((function(t){e.confirmLoading=!1,e.$message.error("请求失败"),i(t)}))})).then()}))},handleCancel:function(){this.visible=!1;var e=this.$refs.createModal.form;e.resetFields()},deviceChange:function(e){},playAudio:function(e){this.play_visible=!0,this.play_confirmLoading=!1,this.audioSrc=O["a"].baseUrl+l["b"].audioApi.play+"?id="+e.id+"&token="+q.a.get(S["a"]),this.audioTitle=e.file_path,this.audioAuthor=e.device_name,this.mdl=e},handlePlayCancel:function(){this.play_visible=!1,this.audioSrc=null},delete_audio:function(e){var t=this;this.loading=!0,new Promise((function(n,a){l["b"].deleteAudio(e).then((function(e){200===e.code&&(t.$message.info(e.message),t.$refs.table.refresh())})).catch((function(e){t.loading=!1,a(e)}))})).then()},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},toggleAdvanced:function(){this.advanced=!this.advanced},resetSearchForm:function(){this.queryParam={date:u()(new Date)}}}},U=T,E=Object(v["a"])(U,a,i,!1,null,null,null);t["default"]=E.exports},"2aae":function(e,t,n){},"88bc":function(e,t,n){(function(t){var n=1/0,a=9007199254740991,i="[object Arguments]",r="[object Function]",o="[object GeneratorFunction]",u="[object Symbol]",c="object"==typeof t&&t&&t.Object===Object&&t,l="object"==typeof self&&self&&self.Object===Object&&self,d=c||l||Function("return this")();function s(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function f(e,t){var n=-1,a=e?e.length:0,i=Array(a);while(++n<a)i[n]=t(e[n],n,e);return i}function m(e,t){var n=-1,a=t.length,i=e.length;while(++n<a)e[i+n]=t[n];return e}var p=Object.prototype,h=p.hasOwnProperty,b=p.toString,v=d.Symbol,y=p.propertyIsEnumerable,g=v?v.isConcatSpreadable:void 0,w=Math.max;function _(e,t,n,a,i){var r=-1,o=e.length;n||(n=S),i||(i=[]);while(++r<o){var u=e[r];t>0&&n(u)?t>1?_(u,t-1,n,a,i):m(i,u):a||(i[i.length]=u)}return i}function A(e,t){return e=Object(e),j(e,t,(function(t,n){return n in e}))}function j(e,t,n){var a=-1,i=t.length,r={};while(++a<i){var o=t[a],u=e[o];n(u,o)&&(r[o]=u)}return r}function O(e,t){return t=w(void 0===t?e.length-1:t,0),function(){var n=arguments,a=-1,i=w(n.length-t,0),r=Array(i);while(++a<i)r[a]=n[t+a];a=-1;var o=Array(t+1);while(++a<t)o[a]=n[a];return o[t]=r,s(e,this,o)}}function S(e){return C(e)||q(e)||!!(g&&e&&e[g])}function x(e){if("string"==typeof e||I(e))return e;var t=e+"";return"0"==t&&1/e==-n?"-0":t}function q(e){return L(e)&&h.call(e,"callee")&&(!y.call(e,"callee")||b.call(e)==i)}var C=Array.isArray;function k(e){return null!=e&&F(e.length)&&!$(e)}function L(e){return R(e)&&k(e)}function $(e){var t=P(e)?b.call(e):"";return t==r||t==o}function F(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=a}function P(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function R(e){return!!e&&"object"==typeof e}function I(e){return"symbol"==typeof e||R(e)&&b.call(e)==u}var T=O((function(e,t){return null==e?{}:A(e,f(_(t,1),x))}));e.exports=T}).call(this,n("c8ba"))},aa98:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"f",(function(){return u})),n.d(t,"c",(function(){return c})),n.d(t,"l",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"j",(function(){return s})),n.d(t,"b",(function(){return f})),n.d(t,"g",(function(){return m})),n.d(t,"d",(function(){return p})),n.d(t,"k",(function(){return h})),n.d(t,"m",(function(){return b})),n.d(t,"h",(function(){return v})),n.d(t,"n",(function(){return y})),n.d(t,"i",(function(){return g})),n.d(t,"o",(function(){return w}));var a=n("b775"),i={create:"/api/device",edit:"/api/device",delete:"/api/device",device_list:"/api/device/list",option:"/api/device/option",device_discovery:"/api/device/discovery",audio_channel_info:"/api/device/audio/channel",audio_set:"/api/device/audio"},r={option:"/api/device/group/option",create:"/api/device/group",edit:"/api/device/group",delete:"/api/device/group",query:"/api/device/group/list"};function o(e){return Object(a["b"])({url:i.create,method:"post",data:e})}function u(e){return Object(a["b"])({url:i.edit,method:"put",data:e})}function c(e){return Object(a["b"])({url:i.delete,method:"delete",data:e})}function l(e){return Object(a["b"])({url:i.device_list,method:"get",params:e})}function d(e){return Object(a["b"])({url:i.device_discovery,method:"get",params:e})}function s(e){return Object(a["b"])({url:r.query,method:"get",params:e})}function f(e){return Object(a["b"])({url:r.create,method:"post",data:e})}function m(e){return Object(a["b"])({url:r.edit,method:"put",data:e})}function p(e){return Object(a["b"])({url:r.delete,method:"delete",data:e})}function h(e){return Object(a["b"])({url:r.option,method:"get",params:e})}function b(e){return Object(a["b"])({url:i.option,method:"get",params:e})}function v(e){return Object(a["b"])({url:i.audio_channel_info,method:"get",params:e})}function y(e){return Object(a["b"])({url:i.audio_channel_info,method:"put",data:e})}function g(e){return Object(a["b"])({url:i.audio_set,method:"get",params:e})}function w(e){return Object(a["b"])({url:i.audio_set,method:"put",data:e})}},dc02:function(e,t,n){"use strict";var a=n("2aae"),i=n.n(a);i.a},dfe3:function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return l}));var a=n("b775"),i={edit:"/api/audio",delete:"/api/audio",open:"/api/audio/channel/open",close:"/api/audio/channel/close",audio_list:"/api/audio/list",play:"/api/audio/play"};function r(e){return Object(a["b"])({url:i.edit,method:"put",data:e})}function o(e){return Object(a["b"])({url:i.delete,method:"delete",data:e})}function u(e){return Object(a["b"])({url:i.audio_list,method:"get",params:e})}function c(e){return Object(a["b"])({url:i.open,method:"post",data:e})}function l(e){return Object(a["b"])({url:i.close,method:"post",data:e})}function d(e){return Object(a["b"])({url:i.play,method:"get",params:e,responseType:"arraybuffer"})}t["b"]={audioApi:i,editAudio:r,openAudio:c,closeAudio:l,getAudioList:u,deleteAudio:o,playAudio:d}}}]);